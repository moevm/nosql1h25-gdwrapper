{% extends 'base.html' %}

{% block title %}
    Просмотр файлов
{% endblock %}

{% block styles %}
    {% load static %}
    <link href="{% static 'css/gdwrapper/index.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block content %}
<div class="filter-bar">
    <div class="row g-3">
        <div class="col-md-3">
            <label for="typeFilter" class="form-label">Тип файла</label>
            <select id="typeFilter" class="form-select">
                <option selected>Все типы</option>
                <option>Документы</option>
                <option>Изображения</option>
                <option>Видео</option>
                <option>Аудио</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="dateFilter" class="form-label">Дата</label>
            <select id="dateFilter" class="form-select">
                <option selected>Любая дата</option>
                <option>Сегодня</option>
                <option>Последние 7 дней</option>
                <option>Этот месяц</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="sizeFilter" class="form-label">Размер</label>
            <select id="sizeFilter" class="form-select">
                <option selected>Любой размер</option>
                <option>Менее 1 MB</option>
                <option>1-10 MB</option>
                <option>Более 10 MB</option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end gap-2 flex-wrap">
            <div class="buttons-group">
                <button class="btn btn-outline-secondary w-100">Применить</button>
                <button class="btn btn-outline-danger w-100">Сбросить</button>
            </div>
        </div>
    </div>
</div>

<!-- Кнопки действий -->
<div class="action-buttons d-flex justify-content-between flex-wrap">
    <div class="buttons-group">
        <button class="btn btn-outline-primary" onclick="setAllFilesCheckboxes(true)">Выбрать всё</button>
        <button class="btn btn-outline-primary" onclick="setAllFilesCheckboxes(false)">Отменить выбор</button>
        <a href="{% url 'refresh_data' %}" onclick="refreshData(event)" class="btn btn-outline-primary">Синхронизировать данные</a>
    </div>
    <div class="buttons-group mt-2 mt-md-0">
        <button class="btn btn-danger">Удалить выбранные</button>
        <button class="btn btn-success">Скачать выбранные</button>
        <button class="btn btn-primary">Загрузить файлы</button>
    </div>
</div>

{% if not is_authenticated %}
    <div class="row justify-content-center align-items-center">
        <div class="col-auto mt-5 text-center">
            <i class="fa-regular fa-face-sad-tear sad-face-icon"></i>
            <h2 class="mt-3">Ой, кажется вы не вошли в аккаунт...</h2>
            <p class="text-muted">Жмите кнопку "Авторизация"!</p>
        </div>
    </div>
{% else %}
    <div class="file-table">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col" style="width: 40px;"></th>
                        <th scope="col">Название</th>
                        <th scope="col">Тип</th>
                        <th scope="col">Размер</th>
                        <th scope="col">Дата изменения</th>
                        <th scope="col">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for document in documents %}
                        <tr>
                            <td><input type="checkbox" class="form-check-input"></td>
                            <td>{{ document.name }}</td>
                            <td>{{ document.mimeType }}</td>
                            <td>{{ document.size }}</td>
                            <td>{{ document.modifiedTime }}</td>
                            <td><button document_id="{{ document.id }}" onclick='showMoreInfo(this)' class="btn btn-sm btn-outline-info details-btn" data-bs-toggle="modal" data-bs-target="#fileDetailsModal">Подробнее</button></td>
                            {{ document | json_script:document.id  }}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}

{% endblock %}


{% block body_tail %}
<div class="modal fade" id="fileDetailsModal" tabindex="-1" aria-labelledby="fileDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fileDetailsModalLabel">Подробная информация о файле</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Название:</div>
                    <div class="col-md-8" id="detailFileName"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Тип:</div>
                    <div class="col-md-8" id="detailFileType"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Размер:</div>
                    <div class="col-md-8" id="detailFileSize"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Дата создания:</div>
                    <div class="col-md-8" id="detailFileCreated"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Дата изменения:</div>
                    <div class="col-md-8" id="detailFileModified"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Владелец:</div>
                    <div class="col-md-8" id="detailFileOwner"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 fw-bold">Права доступа:</div>
                    <pre class="col-md-8" id="detailFilePermissions"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Скачать</button>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/gdwrapper/index.js' %}"></script>
{% endblock %}